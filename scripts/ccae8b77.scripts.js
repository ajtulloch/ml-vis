(function(){"use strict";angular.module("decisionTreeVisualizationApp",["nvd3ChartDirectives"])}).call(this),function(){"use strict";var a;a=function(){function a(a){this.loss=[],this.trainedPoints=[],this.predictor=a}return a.prototype.labelledPair=function(){var a,b;return a=_.map(_.range(this.predictor.config.numFeatures),function(a){return{feature:a+1,value:chance.integer({min:0,max:5})}}),b=chance.bool(),{features:a,label:b}},a.prototype.train=function(){var a;return a=this.labelledPair(),this.trainedPoints.push(a),this.predictor.train(a.features,a.label),this.loss.push({prediction:this.predictor.predict(a.features)})},a.prototype.lossSeries=function(){return[{key:"Loss",values:_.map(this.loss,function(a,b){return[b,a.prediction]})}]},a.prototype.weights=function(){return _.chain(this.predictor.weights).groupBy(function(a,b){return JSON.parse(b).feature}).map(function(a,b){return{key:"Feature "+b,values:_.map(a,function(a){return{x:a.mean,y:a.variance,size:1-a.variance}})}}).value()},a}(),angular.module("decisionTreeVisualizationApp").controller("MainCtrl",["$scope","$log","$interval","AdPredictor",function(b,c,d,e){var f,g=this;return f={beta:.05,priorProbability:.4,numFeatures:10},this.trainer=new a(new e(f)),this.trainingPromise=null,this.train=function(){return g.trainer.train(),b.lossSeries=g.trainer.lossSeries(),b.weights=g.trainer.weights()},this.train(),this.startTraining=function(){return g.trainingPromise=d(g.train,1e3)},this.startTraining(),b.numExamples=function(){return g.trainer.trainedPoints.length},b.xFunction=function(){return function(a){return a.x}},b.yFunction=function(){return function(a){return a.y}},b.formatFunction=function(){return function(a){return d3.round(a,2)}},b.trainingStatus=function(){return null!==g.trainingPromise},b.toggleTraining=function(){return b.trainingStatus()?(d.cancel(g.trainingPromise),g.trainingPromise=null):g.startTraining()}}])}.call(this),function(){"use strict";angular.module("decisionTreeVisualizationApp").directive("decisionTree",function(){return{template:"<div></div>",restrict:"E",link:function(a,b){return b.text("this is the DecisionTree directive")}}})}.call(this),function(){"use strict";function a(a){var b,c,d,e=-39.6968302866538,f=220.946098424521,g=-275.928510446969,h=138.357751867269,i=-30.6647980661472,j=2.50662827745924,k=-54.4760987982241,l=161.585836858041,m=-155.698979859887,n=66.8013118877197,o=-13.2806815528857,p=-.00778489400243029,q=-.322396458041136,r=-2.40075827716184,s=-2.54973253934373,t=4.37466414146497,u=2.93816398269878,v=.00778469570904146,w=.32246712907004,x=2.445134137143,y=3.75440866190742,z=.02425,A=1-z;return 0>a||a>1?(alert("NormSInv: Argument out of range."),d=0):z>a?(b=Math.sqrt(-2*Math.log(a)),d=(((((p*b+q)*b+r)*b+s)*b+t)*b+u)/((((v*b+w)*b+x)*b+y)*b+1)):A>=a?(b=a-.5,c=b*b,d=(((((e*c+f)*c+g)*c+h)*c+i)*c+j)*b/(((((k*c+l)*c+m)*c+n)*c+o)*c+1)):(b=Math.sqrt(-2*Math.log(1-a)),d=-(((((p*b+q)*b+r)*b+s)*b+t)*b+u)/((((v*b+w)*b+x)*b+y)*b+1)),d}angular.module("decisionTreeVisualizationApp").factory("AdPredictor",["$log",function(){var b;return b=function(){function b(a){this.weights={},this.config=a,this.setWeight(this.biasFeature,this.priorBiasWeight())}return b.prototype.biasFeature={feature:0,value:0},b.prototype.priorBiasWeight=function(){var b,c;return b=a(this.config.priorProbability)*(Math.pow(this.config.beta,2)+this.config.numFeatures),c={mean:b,variance:1}},b.prototype.predict=function(a){var b,c,d,e;return a.push(this.biasFeature),e=this.activeMeanVariance(a),c=e[0],d=e[1],b=new NormalDistribution(0,1),b._cdf(c/Math.sqrt(d))},b.prototype.labelToFloat=function(a){return a?-1:1},b.prototype.train=function(a,b){var c,d,e,f,g,h,i,j=this;return a.push(this.biasFeature),g=this.labelToFloat(b),h=this.activeMeanVariance(a),c=h[0],d=h[1],i=this.gaussianCorrections(g*c/Math.sqrt(d)),e=i[0],f=i[1],_.forEach(a,function(a){var b,c,h,i;return i=j.getWeight(a),b=g*i.variance/Math.sqrt(d)*e,h=1-i.variance/d*f,c={mean:i.mean+b,variance:i.variance*h},j.setWeight(a,c)})},b.prototype.getWeight=function(a){var b;return b=JSON.stringify(a),this.weights[b]||{mean:0,variance:1}},b.prototype.setWeight=function(a,b){var c;return c=JSON.stringify(a),this.weights[c]=b},b.prototype.activeMeanVariance=function(a){var b,c,d,e=this;return b=_.map(a,function(a){return e.getWeight(a).mean}),d=_.map(a,function(a){return e.getWeight(a).variance}),c=function(a){return _.reduce(a,function(a,b){return a+b},0)},[c(b),c(d)+Math.pow(this.config.beta,2)]},b.prototype.gaussianCorrections=function(a){var b,c,d;return b=new NormalDistribution(0,1),a=Math.max(-10,Math.min(a,10)),c=b._pdf(a)/b._cdf(a),d=c*(c+a),[c,d]},b}()}])}.call(this);